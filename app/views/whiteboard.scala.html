@(presenter: String, username: String)

@main(username) {
	<h1>whiteboard session</h1>
    
    <div id="messages"></div>
<!--     <img id="image"/> -->

	<div class="outsideWrapper">
		<div class="insideWrapper">
			<img id="image" class="coveredImage">
			<canvas id="canvas" class="coveringCanvas"></canvas>
		</div>
	</div>

<script>
// 	var c = document.getElementById("canvas");
// 	var ctx = c.getContext("2d");
// 	ctx.fillStyle = "#000000";
// 	ctx.fillRect(20, 20, 5, 5);
// 	ctx.fillStyle = "#ffffff";
// 	ctx.fillRect(21, 21, 3, 3);
</script>


<script type="text/javascript" charset="utf-8">
    
        $(function() {
            var WS = window['MozWebSocket'] ? MozWebSocket : WebSocket
            		
            var c = document.getElementById("canvas");
        	var ctx = c.getContext("2d");
            		
	        var socket = new WS("@routes.Application.viewer(presenter, username).webSocketURL(request)")
            var receiveEvent = function(event) {
            	var data = JSON.parse(event.data)
            	if(data.kind == "error") {
                    socket.close()
                    $("#messages").text(data.kind + ": " + data.data)
                    return
                } else if(data.kind == "sendImage") {
                	document.getElementById("image").src="data:image/png;base64," + data.data;
                	document.getElementById("canvas").width = document.getElementById("image").width;
                	document.getElementById("canvas").height = document.getElementById("image").height;
                } else if(data.kind == "sendCursor") {
                	
                	var x = data.x;
                	var y = data.y;
                	
					c.width = c.width;
                	ctx.fillStyle = "#000000";
                	ctx.fillRect(x, y, 5, 5);
                	ctx.fillStyle = "#ffffff";
                	ctx.fillRect(x+1, y+1, 3, 3);
                } else {
                	$("#messages").text("unkown kind: " + data.kind + ": " + data.data)
                }
            }
            
            
            
            socket.onmessage = receiveEvent
            
        })
        
        
    
    </script>
    
}
